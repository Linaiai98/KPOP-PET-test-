# è™šæ‹Ÿå® ç‰©ç³»ç»Ÿ - æ•…éšœæ’é™¤æŒ‡å—

## ğŸš¨ æ’ä»¶é‡è£…å¤±è´¥é—®é¢˜

### é—®é¢˜ï¼šåˆ é™¤æ’ä»¶é‡è£…æ—¶å‡ºç°é»„è‰²æ¡†æŠ¥é”™

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Extension installation failed
Directory already exists at public/scripts/extensions/third-party/KPCP-PET
```

**åŸå› åˆ†æ**ï¼š
- SillyTavernçš„æ’ä»¶åˆ é™¤åŠŸèƒ½æœ‰æ—¶ä¸ä¼šå®Œå…¨æ¸…ç†ç›®å½•
- æ®‹ç•™çš„æ–‡ä»¶å¤¹é˜»æ­¢äº†é‡æ–°å®‰è£…
- è¿™æ˜¯SillyTavernæ‰©å±•ç®¡ç†å™¨çš„å·²çŸ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨åˆ é™¤æ®‹ç•™ç›®å½•ï¼ˆæ¨èï¼‰

1. **å…³é—­SillyTavern**
2. **æ‰¾åˆ°SillyTavernå®‰è£…ç›®å½•**
   - é€šå¸¸åœ¨ï¼š`SillyTavern/public/scripts/extensions/third-party/`
3. **æ‰‹åŠ¨åˆ é™¤æ’ä»¶æ–‡ä»¶å¤¹**
   - åˆ é™¤ `KPCP-PET` æˆ– `virtual-pet-system` æ–‡ä»¶å¤¹
   - ç¡®ä¿æ–‡ä»¶å¤¹å®Œå…¨åˆ é™¤
4. **é‡å¯SillyTavern**
5. **é‡æ–°å®‰è£…æ’ä»¶**

#### æ–¹æ³•äºŒï¼šä½¿ç”¨æ–‡ä»¶ç®¡ç†å™¨æ¸…ç†

**Windowsç”¨æˆ·**ï¼š
1. æŒ‰ `Win + R` æ‰“å¼€è¿è¡Œå¯¹è¯æ¡†
2. è¾“å…¥ `%USERPROFILE%` æˆ–å¯¼èˆªåˆ°SillyTavernç›®å½•
3. æ‰¾åˆ° `SillyTavern\public\scripts\extensions\third-party\`
4. åˆ é™¤å¯¹åº”çš„æ’ä»¶æ–‡ä»¶å¤¹
5. é‡å¯SillyTavernåé‡æ–°å®‰è£…

**Linux/Macç”¨æˆ·**ï¼š
```bash
# å¯¼èˆªåˆ°SillyTavernç›®å½•
cd /path/to/SillyTavern
# åˆ é™¤æ’ä»¶ç›®å½•
rm -rf public/scripts/extensions/third-party/KPCP-PET
# æˆ–è€…
rm -rf public/scripts/extensions/third-party/virtual-pet-system
```

#### æ–¹æ³•ä¸‰ï¼šæ¸…ç†æ‰€æœ‰ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

å¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®‰è£…é—®é¢˜ï¼š
1. å¤‡ä»½é‡è¦çš„æ’ä»¶è®¾ç½®
2. åˆ é™¤æ•´ä¸ª `third-party` æ–‡ä»¶å¤¹
3. é‡å¯SillyTavern
4. é‡æ–°å®‰è£…æ‰€éœ€çš„æ’ä»¶

**æ³¨æ„**ï¼šè¿™ä¼šåˆ é™¤æ‰€æœ‰ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼

### é¢„é˜²æªæ–½

1. **æ­£ç¡®å¸è½½æ’ä»¶**ï¼š
   - å…ˆåœ¨æ‰©å±•è®¾ç½®ä¸­ç¦ç”¨æ’ä»¶
   - ç­‰å¾…å‡ ç§’é’Ÿ
   - å†è¿›è¡Œåˆ é™¤æ“ä½œ

2. **å®šæœŸæ¸…ç†**ï¼š
   - å®šæœŸæ£€æŸ¥ `third-party` ç›®å½•
   - åˆ é™¤ä¸éœ€è¦çš„æ’ä»¶æ–‡ä»¶å¤¹

3. **ä½¿ç”¨Gitå®‰è£…**ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰ï¼š
   ```bash
   cd SillyTavern/public/scripts/extensions/third-party/
   git clone https://github.com/your-repo/virtual-pet-system.git
   ```

## ğŸ” æ‚¬æµ®çª—ä¸æ˜¾ç¤ºçš„æ’æŸ¥æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ–‡ä»¶ç»“æ„

ç¡®ä¿æ–‡ä»¶å¤¹ç»“æ„æ­£ç¡®ï¼š
```
SillyTavern/
â””â”€â”€ public/
    â””â”€â”€ scripts/
        â””â”€â”€ extensions/
            â””â”€â”€ third-party/
                â””â”€â”€ virtual-pet-system/  â† æ–‡ä»¶å¤¹åå¿…é¡»æ˜¯è¿™ä¸ª
                    â”œâ”€â”€ manifest.json
                    â”œâ”€â”€ index.js
                    â”œâ”€â”€ style.css
                    â”œâ”€â”€ popup.html
                    â”œâ”€â”€ settings.html
                    â””â”€â”€ README.md
```

**é‡è¦**ï¼šæ–‡ä»¶å¤¹åå¿…é¡»æ˜¯ `virtual-pet-system`ï¼Œä¸èƒ½æ˜¯å…¶ä»–åç§°ï¼

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

1. æ‰“å¼€SillyTavern
2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
3. ç‚¹å‡»"Console"æ ‡ç­¾
4. åˆ·æ–°é¡µé¢
5. æŸ¥æ‰¾ä»¥ä¸‹ä¿¡æ¯ï¼š

**æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥çœ‹åˆ°ï¼š**
```
[virtual-pet-system] Starting initialization...
[virtual-pet-system] Initializing extension...
[virtual-pet-system] Loading CSS from: scripts/extensions/third-party/virtual-pet-system/style.css
[virtual-pet-system] Loading HTML files...
[virtual-pet-system] HTML files loaded successfully
[virtual-pet-system] Setting up initial state...
[virtual-pet-system] Extension enabled: true
[virtual-pet-system] Toggle element found and set
[virtual-pet-system] Initializing floating button...
[virtual-pet-system] initializeFloatingButton called
[virtual-pet-system] Creating floating button with ID: virtual-pet-button
[virtual-pet-system] Button created, element count: 1
[virtual-pet-system] Button set to default position
[virtual-pet-system] Button initialization complete
[virtual-pet-system] Extension loaded successfully.
```

### ç¬¬ä¸‰æ­¥ï¼šå¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### é”™è¯¯1ï¼šæ‰¾ä¸åˆ°HTMLæ–‡ä»¶
```
[virtual-pet-system] Failed to load HTML files. Error: 404
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ–‡ä»¶å¤¹åç§°æ˜¯å¦ä¸º `virtual-pet-system`
- ç¡®è®¤ `settings.html` å’Œ `popup.html` æ–‡ä»¶å­˜åœ¨
- é‡å¯SillyTavern

#### é”™è¯¯2ï¼šToggle element not found
```
[virtual-pet-system] Toggle element not found: #virtual-pet-enabled-toggle
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- settings.htmlæ–‡ä»¶æ²¡æœ‰æ­£ç¡®åŠ è½½
- æ£€æŸ¥SillyTavernç‰ˆæœ¬å…¼å®¹æ€§
- æ‰‹åŠ¨åˆ·æ–°æ‰©å±•è®¾ç½®é¡µé¢

#### é”™è¯¯3ï¼šButton created, element count: 0
```
[virtual-pet-system] Button created, element count: 0
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- CSSæ ·å¼å†²çª
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ‰©å±•å¹²æ‰°
- å°è¯•ç¦ç”¨å…¶ä»–æ‰©å±•

### ç¬¬å››æ­¥ï¼šæ‰‹åŠ¨å¯ç”¨æ’ä»¶

å¦‚æœè‡ªåŠ¨å¯ç”¨å¤±è´¥ï¼Œå°è¯•æ‰‹åŠ¨å¯ç”¨ï¼š

1. è¿›å…¥SillyTavernæ‰©å±•è®¾ç½®é¡µé¢
2. æ‰¾åˆ°"è™šæ‹Ÿå® ç‰©ç³»ç»Ÿ"é€‰é¡¹
3. æ‰‹åŠ¨å‹¾é€‰å¯ç”¨
4. åˆ·æ–°é¡µé¢

### ç¬¬äº”æ­¥ï¼šå¼ºåˆ¶æ˜¾ç¤ºæŒ‰é’®

å¦‚æœä»ç„¶ä¸æ˜¾ç¤ºï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹ä»£ç ï¼š

```javascript
// æ£€æŸ¥æ’ä»¶æ˜¯å¦åŠ è½½
console.log('jQuery loaded:', typeof jQuery !== 'undefined');
console.log('Body element:', $('body').length);

// æ‰‹åŠ¨åˆ›å»ºæŒ‰é’®è¿›è¡Œæµ‹è¯•
$('body').append(`
<div id="virtual-pet-button-test" style="
    position: fixed;
    top: 50%;
    left: 20px;
    width: 56px;
    height: 56px;
    background: #7289da;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 28px;
    z-index: 999999;
    cursor: pointer;
">ğŸ¾</div>
`);

// æ£€æŸ¥æŒ‰é’®æ˜¯å¦åˆ›å»ºæˆåŠŸ
console.log('Test button created:', $('#virtual-pet-button-test').length);
```

### ç¬¬å…­æ­¥ï¼šæ£€æŸ¥CSSåŠ è½½

åœ¨æ§åˆ¶å°è¿è¡Œï¼š
```javascript
// æ£€æŸ¥CSSæ˜¯å¦åŠ è½½
const cssLoaded = Array.from(document.styleSheets).some(sheet => 
    sheet.href && sheet.href.includes('virtual-pet-system')
);
console.log('CSS loaded:', cssLoaded);
```

### ç¬¬ä¸ƒæ­¥ï¼šæ£€æŸ¥æ‰©å±•è®¾ç½®

1. è¿›å…¥SillyTavernè®¾ç½®é¡µé¢
2. æ‰¾åˆ°æ‰©å±•è®¾ç½®åŒºåŸŸ
3. ç¡®è®¤çœ‹åˆ°"ğŸ¾ è™šæ‹Ÿå® ç‰©ç³»ç»Ÿ"é€‰é¡¹
4. å¦‚æœæ²¡æœ‰çœ‹åˆ°ï¼Œè¯´æ˜æ’ä»¶æ²¡æœ‰æ­£ç¡®åŠ è½½

## ğŸ”§ å…¶ä»–å¸¸è§é—®é¢˜

### é—®é¢˜ï¼šæ’ä»¶åŠ è½½ä½†åŠŸèƒ½ä¸å·¥ä½œ

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥localStorageæ˜¯å¦å¯ç”¨
2. ç¡®è®¤æ²¡æœ‰JavaScripté”™è¯¯
3. æ£€æŸ¥SillyTavernç‰ˆæœ¬å…¼å®¹æ€§

### é—®é¢˜ï¼šç§»åŠ¨ç«¯æ˜¾ç¤ºå¼‚å¸¸

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æ£€æŸ¥CSSåª’ä½“æŸ¥è¯¢
2. ç¡®è®¤è§¦æ‘¸äº‹ä»¶æ­£å¸¸
3. æµ‹è¯•ä¸åŒå±å¹•å°ºå¯¸

### é—®é¢˜ï¼šä¸å…¶ä»–æ‰©å±•å†²çª

**æ’æŸ¥æ­¥éª¤**ï¼š
1. ç¦ç”¨å…¶ä»–æ‰©å±•é€ä¸€æµ‹è¯•
2. æ£€æŸ¥CSSé€‰æ‹©å™¨å†²çª
3. æŸ¥çœ‹JavaScripté”™è¯¯

## ğŸ“ è·å–æ›´å¤šå¸®åŠ©

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æ”¶é›†ä¿¡æ¯**ï¼š
   - SillyTavernç‰ˆæœ¬
   - æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬
   - æ§åˆ¶å°å®Œæ•´é”™è¯¯ä¿¡æ¯
   - æ–‡ä»¶å¤¹ç»“æ„æˆªå›¾

2. **è”ç³»æ”¯æŒ**ï¼š
   - åœ¨GitHub Issuesä¸­æäº¤é—®é¢˜
   - æä¾›è¯¦ç»†çš„å¤ç°æ­¥éª¤
   - é™„ä¸Šæ§åˆ¶å°æ—¥å¿—

## ğŸš€ å¿«é€Ÿä¿®å¤å‘½ä»¤

### è‡ªåŠ¨è¯Šæ–­è„šæœ¬

åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå¿«é€Ÿè¯Šæ–­ï¼š

```javascript
// å®Œæ•´è¯Šæ–­è„šæœ¬
(function() {
    console.log('=== è™šæ‹Ÿå® ç‰©ç³»ç»Ÿè¯Šæ–­ ===');
    console.log('jQuery:', typeof jQuery !== 'undefined');
    console.log('Body element:', $('body').length);
    console.log('Extensions settings:', $('#extensions_settings2').length);
    console.log('Virtual pet toggle:', $('#virtual-pet-enabled-toggle').length);
    console.log('Virtual pet button:', $('#virtual-pet-button').length);
    console.log('LocalStorage available:', typeof localStorage !== 'undefined');

    // æ£€æŸ¥CSS
    const cssLoaded = Array.from(document.styleSheets).some(sheet =>
        sheet.href && sheet.href.includes('virtual-pet-system')
    );
    console.log('CSS loaded:', cssLoaded);

    // æ£€æŸ¥å­˜å‚¨çš„è®¾ç½®
    const enabled = localStorage.getItem('virtual-pet-enabled');
    console.log('Extension enabled in storage:', enabled);

    console.log('=== è¯Šæ–­å®Œæˆ ===');
})();
```

### æ’ä»¶é‡è£…é—®é¢˜æ£€æµ‹è„šæœ¬

```javascript
// æ£€æµ‹æ’ä»¶å®‰è£…é—®é¢˜
(function() {
    console.log('=== æ’ä»¶å®‰è£…é—®é¢˜æ£€æµ‹ ===');

    // æ£€æŸ¥å¯èƒ½çš„æ®‹ç•™ç›®å½•
    const possiblePaths = [
        'scripts/extensions/third-party/KPCP-PET',
        'scripts/extensions/third-party/virtual-pet-system',
        'scripts/extensions/third-party/pet-system'
    ];

    console.log('æ£€æŸ¥å¯èƒ½çš„æ®‹ç•™ç›®å½•...');

    // å°è¯•è®¿é—®è¿™äº›è·¯å¾„æ¥æ£€æµ‹æ˜¯å¦å­˜åœ¨
    possiblePaths.forEach(path => {
        fetch(path + '/manifest.json')
            .then(response => {
                if (response.ok) {
                    console.warn(`âš ï¸ å‘ç°æ®‹ç•™ç›®å½•: ${path}`);
                    console.log(`å»ºè®®æ‰‹åŠ¨åˆ é™¤: SillyTavern/public/${path}`);
                } else {
                    console.log(`âœ… è·¯å¾„æ¸…æ´: ${path}`);
                }
            })
            .catch(() => {
                console.log(`âœ… è·¯å¾„æ¸…æ´: ${path}`);
            });
    });

    // æ£€æŸ¥localStorageä¸­çš„æ®‹ç•™æ•°æ®
    const storageKeys = Object.keys(localStorage).filter(key =>
        key.includes('virtual-pet') || key.includes('KPCP-PET')
    );

    if (storageKeys.length > 0) {
        console.log('ğŸ“¦ å‘ç°localStorageä¸­çš„æ’ä»¶æ•°æ®:');
        storageKeys.forEach(key => console.log(`  - ${key}`));
        console.log('å¦‚éœ€å®Œå…¨é‡ç½®ï¼Œå¯è¿è¡Œæ¸…ç†è„šæœ¬');
    } else {
        console.log('âœ… localStorageä¸­æ— æ®‹ç•™æ•°æ®');
    }

    console.log('=== æ£€æµ‹å®Œæˆ ===');
})();
```

### å¼ºåˆ¶æ¸…ç†è„šæœ¬ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

```javascript
// å¼ºåˆ¶æ¸…ç†æ‰€æœ‰æ’ä»¶æ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰
function forceCleanupPlugin() {
    const confirmed = confirm(
        'âš ï¸ è­¦å‘Šï¼šè¿™å°†åˆ é™¤æ‰€æœ‰è™šæ‹Ÿå® ç‰©ç³»ç»Ÿçš„æ•°æ®ï¼\n' +
        'åŒ…æ‹¬ï¼šå® ç‰©çŠ¶æ€ã€è®¾ç½®ã€å¤´åƒç­‰\n' +
        'ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ'
    );

    if (!confirmed) {
        console.log('âŒ ç”¨æˆ·å–æ¶ˆäº†æ¸…ç†æ“ä½œ');
        return;
    }

    console.log('ğŸ§¹ å¼€å§‹å¼ºåˆ¶æ¸…ç†...');

    // æ¸…ç†localStorage
    const keysToRemove = Object.keys(localStorage).filter(key =>
        key.includes('virtual-pet') ||
        key.includes('KPCP-PET') ||
        key.includes('pet-system')
    );

    keysToRemove.forEach(key => {
        localStorage.removeItem(key);
        console.log(`ğŸ—‘ï¸ å·²åˆ é™¤: ${key}`);
    });

    // æ¸…ç†DOMå…ƒç´ 
    $('#virtual-pet-button').remove();
    $('.virtual-pet-popup-overlay').remove();
    $('#virtual-pet-popup-overlay').remove();

    console.log('âœ… æ¸…ç†å®Œæˆï¼');
    console.log('ğŸ“ å»ºè®®æ­¥éª¤ï¼š');
    console.log('1. æ‰‹åŠ¨åˆ é™¤æ’ä»¶ç›®å½•');
    console.log('2. é‡å¯SillyTavern');
    console.log('3. é‡æ–°å®‰è£…æ’ä»¶');

    alert('æ¸…ç†å®Œæˆï¼è¯·æŒ‰ç…§æ§åˆ¶å°æç¤ºå®Œæˆåç»­æ­¥éª¤ã€‚');
}

// è¿è¡Œæ¸…ç†ï¼ˆå–æ¶ˆæ³¨é‡Šä¸‹é¢è¿™è¡Œæ¥æ‰§è¡Œï¼‰
// forceCleanupPlugin();
```

### ä¸€é”®ä¿®å¤è„šæœ¬

```javascript
// ä¸€é”®å°è¯•ä¿®å¤å¸¸è§é—®é¢˜
function quickFix() {
    console.log('ğŸ”§ å¼€å§‹ä¸€é”®ä¿®å¤...');

    try {
        // 1. é‡æ–°åŠ è½½CSS
        const cssLink = document.querySelector('link[href*="virtual-pet-system"]');
        if (cssLink) {
            const newLink = cssLink.cloneNode();
            newLink.href = cssLink.href + '?t=' + Date.now();
            cssLink.parentNode.replaceChild(newLink, cssLink);
            console.log('âœ… CSSå·²é‡æ–°åŠ è½½');
        }

        // 2. é‡æ–°åˆ›å»ºæŒ‰é’®
        if ($('#virtual-pet-button').length === 0) {
            if (typeof window.createPetButton === 'function') {
                window.createPetButton();
                console.log('âœ… æŒ‰é’®å·²é‡æ–°åˆ›å»º');
            }
        }

        // 3. æ£€æŸ¥å¹¶ä¿®å¤è®¾ç½®
        const enabled = localStorage.getItem('virtual-pet-enabled');
        if (enabled === null) {
            localStorage.setItem('virtual-pet-enabled', 'true');
            console.log('âœ… å·²å¯ç”¨æ’ä»¶è®¾ç½®');
        }

        // 4. åˆ·æ–°æ‰©å±•è®¾ç½®UI
        if ($('#virtual-pet-enabled-toggle').length > 0) {
            $('#virtual-pet-enabled-toggle').prop('checked', enabled !== 'false');
            console.log('âœ… è®¾ç½®UIå·²åŒæ­¥');
        }

        console.log('ğŸ‰ ä¸€é”®ä¿®å¤å®Œæˆï¼');

    } catch (error) {
        console.error('âŒ ä¿®å¤è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', error);
        console.log('å»ºè®®æ‰‹åŠ¨æ’æŸ¥æˆ–è”ç³»å¼€å‘è€…');
    }
}

// è¿è¡Œä¸€é”®ä¿®å¤
quickFix();
```

è¿è¡Œåå°†ç»“æœå‘é€ç»™å¼€å‘è€…ä»¥è·å¾—æ›´ç²¾ç¡®çš„å¸®åŠ©ã€‚
