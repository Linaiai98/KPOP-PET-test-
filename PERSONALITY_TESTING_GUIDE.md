# 虚拟宠物人设功能测试指南

## 🎯 功能概述

虚拟宠物系统现在支持在SillyTavern扩展设置中配置人设，包括5种预设人设和自定义人设功能。

## 📍 人设设置位置

**重要：人设设置已从弹窗移至扩展设置！**

1. 打开SillyTavern
2. 点击右上角的"扩展"按钮（🧩）
3. 在扩展列表中找到"🐾 虚拟宠物系统"
4. 展开设置面板
5. 在"🎭 宠物人设选择"下拉框中选择人设

## 🎭 可用人设类型

### 预设人设
1. **🐱 默认 - 高冷但温柔的猫**
   - 说话傲娇，经常用"哼"开头
   - 喜欢被投喂但嘴上不承认

2. **🐶 活泼 - 热情洋溢的小狗**
   - 说话热情，经常用感叹号
   - 喜欢撒娇卖萌

3. **🐉 优雅 - 古典文雅的龙**
   - 说话古典，喜欢用文言文
   - 举止优雅但内心温暖

4. **🐰 害羞 - 轻声细语的兔子**
   - 说话轻声，容易脸红
   - 喜欢用"..."和颜文字

5. **🐦 聪明 - 机智幽默的鸟**
   - 说话机智，喜欢双关语
   - 偶尔会炫耀知识

### 自定义人设
- 选择"✏️ 自定义人设"
- 在文本框中输入最多500字符的人设描述
- 实时保存，无需手动保存

## 🧪 测试步骤

### 第一步：基础功能测试

1. **打开开发者工具**
   - 按F12或右键选择"检查"
   - 切换到Console标签

2. **检查加载状态**
   ```javascript
   // 查看是否有加载成功的消息
   // 应该看到：🎉 AI人设功能已加载！
   ```

3. **测试API状态**
   ```javascript
   testVirtualPetAI()
   ```

### 第二步：人设切换测试

1. **测试预设人设**
   ```javascript
   // 切换到不同的预设人设
   testPersonalitySwitch('cheerful')  // 活泼小狗
   testPersonalitySwitch('elegant')   // 优雅龙
   testPersonalitySwitch('shy')       // 害羞兔子
   testPersonalitySwitch('smart')     // 聪明鸟
   testPersonalitySwitch('default')   // 默认猫
   ```

2. **测试自定义人设**
   ```javascript
   testPersonalitySwitch('custom')
   // 会弹出输入框，输入自定义人设描述
   ```

3. **通过UI测试**
   - 在扩展设置中切换下拉框
   - 观察自定义输入框的显示/隐藏
   - 输入自定义人设文本

### 第三步：AI回复测试

1. **手动测试AI回复**
   ```javascript
   testAIReply('feed')   // 测试喂食回复
   testAIReply('play')   // 测试玩耍回复
   testAIReply('sleep')  // 测试休息回复
   ```

2. **通过UI测试**
   - 点击虚拟宠物按钮（🐾）
   - 点击"🍖 喂食"、"🎾 玩耍"、"😴 休息"按钮
   - 观察回复是否符合当前人设

## 📊 预期结果

### 如果SillyTavern API可用：
- 显示"正在思考..."加载提示
- 根据人设生成个性化回复
- 回复内容符合人设特点

### 如果SillyTavern API不可用：
- 直接显示默认回复
- 控制台显示"SillyTavern API不可用，使用静态回复"

## 🔍 故障排除

### 1. 看不到扩展设置
- 确保SillyTavern正常运行
- 检查扩展是否正确加载
- 尝试刷新页面

### 2. 人设切换无效
- 检查控制台是否有错误信息
- 运行`testVirtualPetAI()`查看当前状态
- 确认localStorage可用

### 3. AI回复不工作
- 这是正常的，需要SillyTavern连接AI模型
- 可以测试人设保存和Prompt生成功能
- 检查控制台的API可用性信息

### 4. 自定义人设不保存
- 检查浏览器是否允许localStorage
- 确认文本框有内容
- 查看控制台错误信息

## 💡 测试建议

1. **先测试人设切换**
   - 确保基础功能正常
   - 验证数据保存和加载

2. **再测试AI回复**
   - 如果API不可用，专注测试人设功能
   - 观察Prompt生成是否正确

3. **对比不同人设**
   - 切换人设后测试同一个行为
   - 观察生成的Prompt差异

4. **测试边界情况**
   - 空的自定义人设
   - 超长的自定义人设
   - 特殊字符的处理

## 🎉 成功标志

- ✅ 扩展设置中能看到人设选择下拉框
- ✅ 切换人设时有成功提示
- ✅ 自定义人设输入框正常显示/隐藏
- ✅ 控制台测试命令正常工作
- ✅ 虚拟宠物互动时使用正确的人设
- ✅ Prompt生成包含人设信息

如果以上功能都正常，说明人设系统已经成功集成！
