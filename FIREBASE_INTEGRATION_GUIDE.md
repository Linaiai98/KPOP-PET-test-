# 🔥 Firebase集成使用指南

## 📋 概述

虚拟宠物系统现已完全集成Firebase，实现真正的跨设备数据同步。您可以在电脑、手机、平板等多个设备间无缝同步宠物数据、AI设置和自定义头像。

## 🚀 快速开始

### 1. 启用Firebase同步

1. 打开SillyTavern
2. 进入**扩展设置**
3. 找到**🐾 虚拟宠物系统**
4. 点击**🔥 Firebase同步管理**按钮

### 2. 首次设置（主设备）

在您的主设备（通常是电脑）上：

1. 打开Firebase同步管理面板
2. 等待Firebase服务初始化完成
3. 点击**⬆️ 同步所有数据**，将当前数据上传到云端
4. 如需连接其他设备，点击**🔗 生成连接码**

### 3. 连接其他设备

在其他设备（手机、平板等）上：

1. 打开Firebase同步管理面板
2. 在主设备上生成6位连接码
3. 在从设备上输入连接码
4. 点击**📲 连接设备**
5. 等待数据自动同步完成

## 🔄 同步功能详解

### 自动同步的数据

✅ **宠物数据**：名称、等级、经验、健康、快乐、饥饿、精力、金币等  
✅ **AI设置**：API配置、模型选择、人设设置等  
✅ **界面设置**：按钮位置、自定义头像等  
✅ **游戏进度**：成就、物品库存等  

### 同步时机

- 📤 **实时上传**：数据变更时自动上传到云端
- 📥 **实时下载**：监听云端变更并自动更新本地
- 🔄 **冲突解决**：基于时间戳的最新优先策略
- 🌐 **网络恢复**：网络恢复时自动同步待处理数据

## 📱 设备管理

### 连接码机制

- **有效期**：5分钟
- **格式**：6位大写字母数字组合
- **用途**：解决Firebase匿名认证跨设备身份统一问题

### 设备列表

在Firebase同步管理面板中可以：
- 查看所有已连接设备
- 查看设备最后活跃时间
- 断开不需要的设备连接

## 🛠️ 故障排除

### 常见问题

#### 1. Firebase服务未就绪
**症状**：显示"Firebase服务: ❌ 未就绪"  
**解决**：
```javascript
// 在控制台运行
FirebaseTest.testBasics()
```

#### 2. 用户认证失败
**症状**：显示"用户认证: ❌ 未认证"  
**解决**：
```javascript
// 重置Firebase连接
window.FirebaseService.cleanup();
await window.FirebaseService.initialize();
```

#### 3. 数据同步失败
**症状**：数据在设备间不一致  
**解决**：
1. 检查网络连接
2. 点击**🔄 重置Firebase连接**
3. 重新同步数据

#### 4. 连接码无效
**症状**：提示"连接码不存在或已过期"  
**解决**：
1. 确认连接码在5分钟有效期内
2. 检查输入是否正确（6位大写）
3. 重新生成连接码

### 调试工具

#### 快速状态检查
```javascript
FirebaseTest.quickCheck()
```

#### 完整功能测试
```javascript
FirebaseTest.runFullSuite()
```

#### 手动同步数据
```javascript
// 同步宠物数据
const petData = getLocalPetData();
await FirebaseSync.uploadPetData(petData);

// 同步AI设置
const aiSettings = getLocalAISettings();
await FirebaseSync.uploadAISettings(aiSettings);
```

## 🔒 安全与隐私

### 数据加密

- **API密钥**：使用Base64编码存储
- **传输安全**：Firebase自动使用HTTPS加密
- **访问控制**：只有认证用户可访问自己的数据

### 数据存储

- **位置**：Google Firebase云服务器
- **备份**：Firebase自动备份和冗余
- **删除**：可通过清除本地数据功能删除

## 📊 监控与状态

### 同步状态指示器

- 🟢 **在线同步**：实时同步正常
- 🟡 **离线模式**：本地缓存，网络恢复时同步
- 🔴 **同步失败**：需要手动重试或检查配置

### 性能优化

- **增量同步**：只同步变更的数据
- **压缩传输**：大文件自动压缩
- **缓存机制**：本地缓存减少网络请求
- **批量操作**：合并多个操作减少API调用

## 🎯 最佳实践

### 设备连接建议

1. **主设备选择**：选择使用最频繁的设备作为主设备
2. **连接顺序**：先在主设备上传数据，再连接其他设备
3. **定期清理**：定期断开不再使用的设备连接

### 数据管理建议

1. **定期备份**：虽然有云端同步，建议定期导出重要数据
2. **网络环境**：在稳定网络环境下进行首次同步
3. **冲突避免**：避免在多设备上同时进行大量操作

## 🆘 技术支持

### 获取帮助

1. **查看控制台**：按F12查看详细错误信息
2. **运行测试**：使用内置测试工具诊断问题
3. **重置功能**：使用重置功能解决严重问题

### 联系方式

如果遇到无法解决的问题：
1. 收集错误日志和控制台信息
2. 记录复现步骤
3. 在GitHub Issues中提交问题报告

## 🔮 未来功能

计划中的功能：
- 📊 数据使用统计
- 🔄 自动备份策略
- 🌍 多语言支持
- 📱 移动端专用优化

---

**🎉 享受跨设备的无缝虚拟宠物体验！**
