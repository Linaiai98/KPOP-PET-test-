# è™šæ‹Ÿå® ç‰©æ’ä»¶ - Node.js ä¸­ç»§æœåŠ¡å™¨

## ğŸ¯ åŠŸèƒ½è¯´æ˜

è¿™ä¸ªä¸­ç»§æœåŠ¡å™¨è§£å†³äº†è™šæ‹Ÿå® ç‰©æ’ä»¶åœ¨ç§»åŠ¨ç«¯å’ŒæŸäº›ç½‘ç»œç¯å¢ƒä¸‹æ— æ³•ç›´æ¥è®¿é—®ç¬¬ä¸‰æ–¹APIçš„é—®é¢˜ã€‚

### ä¸»è¦ç‰¹æ€§

- âœ… **APIä»£ç†è½¬å‘**ï¼šå°†æ’ä»¶çš„APIè¯·æ±‚è½¬å‘åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡
- âœ… **ç§»åŠ¨ç«¯ä¼˜åŒ–**ï¼šè§£å†³ç§»åŠ¨è®¾å¤‡ç½‘ç»œè¿æ¥é—®é¢˜
- âœ… **VPNç»•è¿‡**ï¼šç”¨æˆ·æ— éœ€é…ç½®VPNå³å¯è®¿é—®å—é™API
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… **ç»Ÿè®¡ç›‘æ§**ï¼šæä¾›è¯·æ±‚ç»Ÿè®¡å’ŒæœåŠ¡å™¨çŠ¶æ€ç›‘æ§
- âœ… **CORSæ”¯æŒ**ï¼šå®Œæ•´çš„è·¨åŸŸèµ„æºå…±äº«æ”¯æŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. å¯åŠ¨æœåŠ¡å™¨

```bash
# ç”Ÿäº§ç¯å¢ƒ
npm start

# å¼€å‘ç¯å¢ƒï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev
```

### 3. æµ‹è¯•æœåŠ¡å™¨

```bash
npm test
```

## ğŸ“¡ æœåŠ¡å™¨é…ç½®

### é»˜è®¤é…ç½®

- **ç«¯å£**: 3000
- **IP**: 0.0.0.0 (ç›‘å¬æ‰€æœ‰æ¥å£)
- **å…¬ç½‘è®¿é—®**: http://154.12.38.33:3000

### ç¯å¢ƒå˜é‡

```bash
# è‡ªå®šä¹‰ç«¯å£
PORT=3000

# ç”Ÿäº§ç¯å¢ƒ
NODE_ENV=production
```

## ğŸ”— APIç«¯ç‚¹

### 1. å¥åº·æ£€æŸ¥

```http
GET /health
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "healthy",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "uptime": 3600,
  "version": "1.0.0"
}
```

### 2. APIä»£ç†

```http
POST /proxy
```

**è¯·æ±‚ä½“**:
```json
{
  "targetUrl": "https://api.openai.com/v1/chat/completions",
  "method": "POST",
  "headers": {
    "Content-Type": "application/json",
    "Authorization": "Bearer sk-..."
  },
  "body": {
    "model": "gpt-3.5-turbo",
    "messages": [{"role": "user", "content": "Hello"}]
  }
}
```

### 3. ç»Ÿè®¡ä¿¡æ¯

```http
GET /stats
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "totalRequests": 150,
  "successRequests": 145,
  "errorRequests": 5,
  "successRate": "96.67%",
  "uptime": 7200,
  "memory": {...},
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

## ğŸ”§ æ’ä»¶é›†æˆ

æ’ä»¶å·²è‡ªåŠ¨é…ç½®ä¸ºä½¿ç”¨ä¸­ç»§æœåŠ¡å™¨ã€‚åŸæ¥çš„APIè°ƒç”¨ï¼š

```javascript
// åŸæ¥çš„ç›´è¿æ–¹å¼
fetch('https://api.openai.com/v1/chat/completions', {
  method: 'POST',
  headers: { ... },
  body: JSON.stringify({ ... })
})
```

ç°åœ¨é€šè¿‡ä¸­ç»§æœåŠ¡å™¨ï¼š

```javascript
// é€šè¿‡ä¸­ç»§æœåŠ¡å™¨
fetch('http://154.12.38.33:3000/proxy', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    targetUrl: 'https://api.openai.com/v1/chat/completions',
    method: 'POST',
    headers: { ... },
    body: { ... }
  })
})
```

## ğŸ› ï¸ éƒ¨ç½²æŒ‡å—

### WindowsæœåŠ¡å™¨éƒ¨ç½²

1. **å®‰è£…Node.js**
   - ä¸‹è½½å¹¶å®‰è£… Node.js 16+ ç‰ˆæœ¬
   - éªŒè¯å®‰è£…ï¼š`node --version`

2. **ä¸Šä¼ æ–‡ä»¶**
   - å°†æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨
   - è¿›å…¥é¡¹ç›®ç›®å½•

3. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```

4. **å¯åŠ¨æœåŠ¡**
   ```bash
   npm start
   ```

5. **é…ç½®é˜²ç«å¢™**
   - å¼€æ”¾ç«¯å£3000
   - å…è®¸å¤–éƒ¨è®¿é—®

### ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹

```bash
# å®‰è£…PM2
npm install -g pm2

# å¯åŠ¨æœåŠ¡
pm2 start relay-server.js --name "virtual-pet-relay"

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs virtual-pet-relay
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :3000

# æ€æ­»è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F
```

#### 2. é˜²ç«å¢™é˜»æ‹¦
- æ£€æŸ¥Windowsé˜²ç«å¢™è®¾ç½®
- ç¡®ä¿ç«¯å£3000å·²å¼€æ”¾
- æ£€æŸ¥äº‘æœåŠ¡å™¨å®‰å…¨ç»„è®¾ç½®

#### 3. ç½‘ç»œè¿æ¥é—®é¢˜
```bash
# æµ‹è¯•æœ¬åœ°è¿æ¥
curl http://localhost:3000/health

# æµ‹è¯•å…¬ç½‘è¿æ¥
curl http://154.12.38.33:3000/health
```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
DEBUG=* npm start
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
pm2 logs virtual-pet-relay --lines 100

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs virtual-pet-relay --err
```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
pm2 monit

# é‡å¯æœåŠ¡
pm2 restart virtual-pet-relay

# é‡è½½é…ç½®
pm2 reload virtual-pet-relay
```

## ğŸ”’ å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. **é™åˆ¶CORSæ¥æº**
   ```javascript
   app.use(cors({
     origin: ['chrome-extension://your-extension-id'],
     credentials: true
   }));
   ```

2. **æ·»åŠ è¯·æ±‚é™åˆ¶**
   ```bash
   npm install express-rate-limit
   ```

3. **å¯ç”¨HTTPS**
   - é…ç½®SSLè¯ä¹¦
   - ä½¿ç”¨åå‘ä»£ç†ï¼ˆNginxï¼‰

4. **ç›‘æ§å’Œæ—¥å¿—**
   - é…ç½®æ—¥å¿—è½®è½¬
   - è®¾ç½®ç›‘æ§å‘Šè­¦

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. âœ… Node.jsç‰ˆæœ¬ >= 14.0.0
2. âœ… æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…
3. âœ… é˜²ç«å¢™å’Œç½‘ç»œé…ç½®æ­£ç¡®
4. âœ… æœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„å†…å­˜å’ŒCPUèµ„æº

## ğŸ‰ æµ‹è¯•éªŒè¯

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// æµ‹è¯•ä¸­ç»§æœåŠ¡å™¨è¿æ¥
testRelayServer()

// æµ‹è¯•æ’ä»¶APIè°ƒç”¨
// é…ç½®å¥½APIåï¼Œå°è¯•ä¸å® ç‰©èŠå¤©
```

ç°åœ¨ä½ çš„è™šæ‹Ÿå® ç‰©æ’ä»¶å¯ä»¥é€šè¿‡ä¸­ç»§æœåŠ¡å™¨ç¨³å®šè®¿é—®å„ç§ç¬¬ä¸‰æ–¹APIäº†ï¼ğŸš€
